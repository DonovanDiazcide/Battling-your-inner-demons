{% block title %}
    Etapa 3 y 4 (adivinas tus puntajes y defines un rango aceptable en las pruebas de la Etapa 2)
{% endblock %}

{% block styles %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.css" rel="stylesheet"/>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 0;
    }
     #assoc_iat1,
  #assoc_iat2 {
    display: none;
  }

    /* 1. Form más ancho y adaptativo */
/* 1. Form más ancho y adaptativo */
form {
/* Ancho máximo de formulario */
max-width: 5000px;
/* Ocupa todo el ancho disponible para mantener centrado */
width: 100%;
margin: 1px auto;
padding: 0px;
background-color: #fff;
border-radius: 5px;
box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
box-sizing: border-box;
    h2, h3 {
        color: #333;
        text-align: center;
        margin-bottom: 15px;
    }
    p, ul {
        text-align: center;
        line-height: 1.5;
        color: #444;
    }
    ul {
        list-style-type: none;
        padding: 0;
    }
    ul li {
        margin: 4px 0;
    }

    /* 2. Contenedor flexible para las dos tablas */
    .classification-wrapper {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        margin-bottom: 60px;
    }
    .classification-section {
        width: 45%;
        min-width: 300px;
        box-sizing: border-box;
        margin-bottom: 20px;
    }

    /* 3. Wrapper con scroll horizontal y tabla 100% */
    .table-wrapper {
        overflow-x: auto;
    }
    .table-wrapper table {
        border-collapse: collapse;
        width: 100%;
        min-width: 320px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }
    .table-wrapper th,
    .table-wrapper td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: center;
    }

    /* Estilo “pizarra” para 7 columnas con botones atractivos */
    .iat-container {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        background-color: #333;
        border: 2px solid #fff;
        margin: 20px auto;
        border-radius: 4px;
        overflow: hidden;
    }
    .iat-container label { margin: 0; }
    .iat-column {
        position: relative;
        border-right: 2px solid #fff;
        cursor: pointer;
        text-align: center;
        color: #fff;
        padding: 20px 5px;
        user-select: none;
        transition: background-color 0.2s ease, transform 0.2s ease;
    }
    .iat-column:last-child { border-right: none; }
    .iat-column input[type="radio"] { display: none; }
    .iat-column .text {
        font-size: 0.85rem;
        line-height: 1.3;
    }
    .iat-column:hover {
        background-color: #444;
        transform: translateY(-2px);
    }
    .iat-column input[type="radio"]:checked + .text {
        background-color: #666;
        border-radius: 4px;
        padding: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    /* Slider Section */
    .slider-section {
        margin: 25px 0;
    }
    .slider-section label {
        font-weight: bold;
        margin-bottom: 8px;
        display: block;
        text-align: center;
    }
    .range-display {
        margin-top: 8px;
        color: #555;
        font-style: italic;
        text-align: center;
    }
    .slider {
        margin: 0 auto 10px auto;
        width: 90%;
    }

    /* Asociación dinámica */
    .assoc-display {
        text-align: center;
        font-size: 1.1rem;
        color: #007bff;
        margin-bottom: 15px;
    }

    /* Botón */
    button {
        display: block;
        width: 100%;
        padding: 14px;
        margin-top: 30px;
        background-color: #007bff;
        color: #fff;
        font-size: 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    button:hover {
        background-color: #0056b3;
    }

    /* Errores */
    .otree-form-errors {
        color: red;
        margin-top: 5px;
        font-size: 0.9rem;
        text-align: center;
    }
</style>

{% endblock %}


{% block content %}

<!-- iat: Personas obesas/Personas delgadas -->
<div>
  <h2>Prueba de asociación implícita: Personas obesas/Personas delgadas</h2>
    <p>Por el diseño de la prueba, el resultado del tu prueba de asociación implícita se encuentra entre el rango <strong>-2</strong> y <strong>2</strong>:</p>
    <p>Tu resultado podrá corresponder a alguno de los siguientes rangos puntuaciones y asociaciones:</p>
  <div class="classification-wrapper">
    <!-- Clasificaciones Negativas -->
    <div class="classification-section">
      <h3>Puntuaciones menores a 0</h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Rango</th>
              <th>Asociación</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>[-0.15, 0.15]</td>
              <td><strong>Neutral</strong></td>
            </tr>
            <tr>
              <td>[-0.35, -0.16]</td>
              <td><strong>Leve</strong>: <strong>Personas delgadas</strong> bueno, <strong>Personas obesas</strong> malo</td>
            </tr>
            <tr>
              <td>[-0.65, -0.36]</td>
              <td><strong>Moderada</strong>: <strong>Personas delgadas</strong> bueno, <strong>Personas obesas</strong> malo</td>
            </tr>
            <tr>
              <td>[-2, -0.66]</td>
              <td><strong>Fuerte</strong>: <strong>Personas delgadas</strong> bueno, <strong>Personas obesas</strong> malo</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!-- Clasificaciones Positivas -->
    <div class="classification-section">
      <h3>Puntuaciones mayores a 0</h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Rango</th>
              <th>Asociación</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>[-0.15, 0.15]</td>
              <td><strong>Neutral</strong></td>
            </tr>
            <tr>
              <td>[0.16, 0.35]</td>
              <td><strong>Leve</strong>: <strong>Personas obesas</strong> bueno, <strong>Personas delgadas</strong> malo</td>
            </tr>
            <tr>
              <td>[0.36, 0.65]</td>
              <td><strong>Moderada</strong>: <strong>Personas obesas</strong> bueno, <strong>Personas delgadas</strong> malo</td>
            </tr>
            <tr>
              <td>[0.66, 2]</td>
              <td><strong>Fuerte</strong>: <strong>Personas obesas</strong> bueno, <strong>Personas delgadas</strong> malo</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- iat: Personas homosexuales/Personas heterosexuales -->
<div>
  <h2>Prueba de asociación implícita: Personas homosexuales/Personas heterosexuales</h2>
  <div class="classification-wrapper">
    <!-- Clasificaciones Negativas -->
    <div class="classification-section">
      <h3>Puntuaciones menores a 0</h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Rango</th>
              <th>Asociación</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>[-0.15, 0.15]</td>
              <td><strong>Neutral</strong></td>
            </tr>
            <tr>
              <td>[-0.35, -0.16]</td>
              <td><strong>Leve</strong>: <strong>Personas heterosexuales</strong> bueno, <strong>Personas homosexuales</strong> malo</td>
            </tr>
            <tr>
              <td>[-0.65, -0.36]</td>
              <td><strong>Moderada</strong>: <strong>Personas heterosexuales</strong> bueno, <strong>Personas homosexuales</strong> malo</td>
            </tr>
            <tr>
              <td>[-2, -0.66]</td>
              <td><strong>Fuerte</strong>: <strong>Personas heterosexuales</strong> bueno, <strong>Personas homosexuales</strong> malo</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!-- Clasificaciones Positivas -->
    <div class="classification-section">
      <h3>Puntuaciones mayores a 0</h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Rango</th>
              <th>Asociación</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>[-0.15, 0.15]</td>
              <td><strong>Neutral</strong></td>
            </tr>
            <tr>
              <td>[0.16, 0.35]</td>
              <td><strong>Leve</strong>: <strong>Personas homosexuales</strong> bueno, <strong>Personas heterosexuales</strong> malo</td>
            </tr>
            <tr>
              <td>[0.36, 0.65]</td>
              <td><strong>Moderada</strong>: <strong>Personas homosexuales</strong> bueno, <strong>Personas heterosexuales</strong> malo</td>
            </tr>
            <tr>
              <td>[0.66, 2]</td>
              <td><strong>Fuerte</strong>: <strong>Personas homosexuales</strong> bueno, <strong>Personas heterosexuales</strong> malo</td>
            </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<!-- Mensaje introductorio para la selección -->
<h3>¿En qué rango de valores crees que cayó tu puntuación de la Prueba de asociación implícita en la que comparamos cómo asocias personas gordas y a personas delgadas? </h3>
<p> A través de la siguiente barra clickeable, selecciona el rango en donde crees que se encuentra tu Prueba de asociación implícita, solo en caso de que aciertes, te daremos una compensación monetaria por ello.
</p>
<form method="post">

  <!-- ====================== iat1: Personas obesas/Personas delgadas ====================== -->
  <div class="iat-container">
    <label class="iat-column">
      <input type="radio" name="iat1_self_assessment" value="Fuerte: Personas delgadas+bueno, Personas obesas+malo" />
      <div class="text">
        <strong>Fuerte</strong><br>
        Personas delgadas+bueno, Personas obesas+malo<br>
        <span style="font-size:0.8rem">(Rango: [-2, -0.66])</span>
      </div>
    </label>
    <label class="iat-column">
      <input type="radio" name="iat1_self_assessment" value="Moderada: Personas delgadas+bueno, Personas obesas+malo" />
      <div class="text">
        <strong>Moderada</strong><br>
        Personas delgadas+bueno, Personas obesas+malo<br>
        <span style="font-size:0.8rem">(Rango: [-0.65, -0.36])</span>
      </div>
    </label>
    <label class="iat-column">
      <input type="radio" name="iat1_self_assessment" value="Leve: Personas delgadas+bueno, Personas obesas+malo" />
      <div class="text">
        <strong>Leve</strong><br>
        Personas delgadas+bueno, Personas obesas+malo<br>
        <span style="font-size:0.8rem">(Rango: [-0.35, -0.16])</span>
      </div>
    </label>
    <label class="iat-column">
      <input type="radio" name="iat1_self_assessment" value="Neutral" />
      <div class="text">
        <strong>Neutral</strong><br>
        <span style="font-size:0.8rem">(Rango: [-0.15, 0.15])</span>
      </div>
    </label>
    <label class="iat-column">
      <input type="radio" name="iat1_self_assessment" value="Leve: Personas obesas+bueno, Personas delgadas+malo" />
      <div class="text">
        <strong>Leve</strong><br>
        Personas obesas+bueno, Personas delgadas+malo<br>
        <span style="font-size:0.8rem">(Rango: [0.16, 0.35])</span>
      </div>
    </label>
    <label class="iat-column">
      <input type="radio" name="iat1_self_assessment" value="Moderada: Personas obesas+bueno, Personas delgadas+malo" />
      <div class="text">
        <strong>Moderada</strong><br>
        Personas obesas+bueno, Personas delgadas+malo<br>
        <span style="font-size:0.8rem">(Rango: [0.36, 0.65])</span>
      </div>
    </label>
    <label class="iat-column">
      <input type="radio" name="iat1_self_assessment" value="Fuerte: Personas obesas+bueno, Personas delgadas+malo" />
      <div class="text">
        <strong>Fuerte</strong><br>
        Personas obesas+bueno, Personas delgadas+malo<br>
        <span style="font-size:0.8rem">(Rango: [0.66, 2])</span>
      </div>
    </label>
  </div>
  {{ formfield_errors 'iat1_self_assessment' }}

    <!-- Range Slider (Double-handle) para iat1_lower_limit e iat1_upper_limit -->
    <div class="slider-section">
      <label>
          <h3>¿Cuál consideras que es un rango de puntuaciones aceptable en una prueba de asociación implícita en la que comparamos cómo asocias a personas gordas y a personas delgadas?</h3>
      </label>
          <p>Puedes seleccionar el límite superior e inferior de tu rango de puntuación y asociación mediante esta barra, cuyos límites puedes mover con el mouse, touchpad o
          pantalla. </p>
          <br>

      <div id="slider_iat1" class="slider"></div>
      <label> Actualmente estás seleccionando:
        <span class="range-display" id="display_iat1_range"></span>
      </label>
        <div class="assoc-display" id="assoc_iat1"></div>
      <!-- Inputs ocultos -->
      <input type="hidden" name="iat1_lower_limit" id="iat1_lower_limit"/>
      <input type="hidden" name="iat1_upper_limit" id="iat1_upper_limit"/>
      {{ formfield_errors 'iat1_lower_limit' }}
      {{ formfield_errors 'iat1_upper_limit' }}
    </div>

    <hr>

  <!-- ====================== iat2: Personas homosexuales/Personas heterosexuales ====================== -->
<h3>¿En qué rango de valores crees que cayó tu puntuación de la Prueba de asociación implícita en la que comparamos cómo asocias personas heterosexuales y a personas homosexuales? </h3>
<p> A través de la siguiente barra clickeable, selecciona el rango en donde crees que se encuentra tu Prueba de asociación implícita, solo en caso de que aciertes, te daremos una compensación monetaria por ello.</p>

<!-- Radio Buttons (7 columnas) con Neutral centrado -->
<div class="iat-container">
  <!-- Opción 1: Fuerte Personas heterosexuales+bueno, Personas homosexuales+malo -->
  <label class="iat-column">
    <input type="radio" name="iat2_self_assessment" value="Fuerte: Personas heterosexuales+bueno, Personas homosexuales+malo" />
    <div class="text">
      <strong>Fuerte</strong><br>
      Personas heterosexuales+bueno, Personas homosexuales+malo<br>
      <span style="font-size:0.8rem">(Rango: [-2, -0.66])</span>
    </div>
  </label>
  <!-- Opción 2: Moderada Personas heterosexuales+bueno, Personas homosexuales+malo -->
  <label class="iat-column">
    <input type="radio" name="iat2_self_assessment" value="Moderada: Personas heterosexuales+bueno, Personas homosexuales+malo" />
    <div class="text">
      <strong>Moderada</strong><br>
      Personas heterosexuales+bueno, Personas homosexuales+malo<br>
      <span style="font-size:0.8rem">(Rango: [-0.65, -0.36])</span>
    </div>
  </label>
  <!-- Opción 3: Leve Personas heterosexuales+bueno, Personas homosexuales+malo -->
  <label class="iat-column">
    <input type="radio" name="iat2_self_assessment" value="Leve: Personas heterosexuales+bueno, Personas homosexuales+malo" />
    <div class="text">
      <strong>Leve</strong><br>
      Personas heterosexuales+bueno, Personas homosexuales+malo<br>
      <span style="font-size:0.8rem">(Rango: [-0.35, -0.16])</span>
    </div>
  </label>
  <!-- Opción 4: Neutral -->
  <label class="iat-column">
    <input type="radio" name="iat2_self_assessment" value="Neutral" />
    <div class="text">
      <strong>Neutral</strong><br>
      <span style="font-size:0.8rem">(Rango: [-0.15, 0.15])</span>
    </div>
  </label>
  <!-- Opción 5: Leve Personas homosexuales+bueno, Personas heterosexuales+malo -->
  <label class="iat-column">
    <input type="radio" name="iat2_self_assessment" value="Leve: Personas homosexuales+bueno, Personas heterosexuales+malo" />
    <div class="text">
      <strong>Leve</strong><br>
      Personas homosexuales+bueno, Personas heterosexuales+malo<br>
      <span style="font-size:0.8rem">(Rango: [0.16, 0.35])</span>
    </div>
  </label>
  <!-- Opción 6: Moderada Personas homosexuales+bueno, Personas heterosexuales+malo -->
  <label class="iat-column">
    <input type="radio" name="iat2_self_assessment" value="Moderada: Personas homosexuales+bueno, Personas heterosexuales+malo" />
    <div class="text">
      <strong>Moderada</strong><br>
      Personas homosexuales+bueno, Personas heterosexuales+malo<br>
      <span style="font-size:0.8rem">(Rango: [0.36, 0.65])</span>
    </div>
  </label>
  <!-- Opción 7: Fuerte Personas homosexuales+bueno, Personas heterosexuales+malo -->
  <label class="iat-column">
    <input type="radio" name="iat2_self_assessment" value="Fuerte: Personas homosexuales+bueno, Personas heterosexuales+malo" />
    <div class="text">
      <strong>Fuerte</strong><br>
      Personas homosexuales+bueno, Personas heterosexuales+malo<br>
      <span style="font-size:0.8rem">(Rango: [0.66, 2])</span>
    </div>
  </label>
</div>
{{ formfield_errors 'iat2_self_assessment' }}

    <!-- Range Slider (Double-handle) para iat2_lower_limit e iat2_upper_limit -->
    <div class="slider-section">
        <h3>¿Cuál sería para ti un rango moralmente aceptable para el Prueba de asociación implícita persona homosexual/persona heterosexual?</h3>
          <p>Puedes seleccionar el límite superior e inferior de tu rango de puntuación y asociación mediante esta barra, cuyos límites puedes mover con el mouse, touchpad o
          pantalla. </p>

      <div id="slider_iat2" class="slider"></div>
        <label>
          <br> Actualmente estás seleccionando:
        <span class="range-display" id="display_iat2_range"></span>
      </label>


      <input type="hidden" name="iat2_lower_limit" id="iat2_lower_limit"/>
      <input type="hidden" name="iat2_upper_limit" id="iat2_upper_limit"/>
      {{ formfield_errors 'iat2_lower_limit' }}
      {{ formfield_errors 'iat2_upper_limit' }}
    </div>

    <button type="submit">Continuar</button>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.js"></script>
<script>
  // Función para determinar la clasificación en función del valor (incluye umbrales inclusivos)
  function getClassification(value) {
      var absVal = Math.abs(value);
      if (absVal <= 0.15) {
          return "Neutral";
      } else if (absVal <= 0.35) {
          return "Asociación leve";
      } else if (absVal <= 0.65) {
          return "Asociación moderada";
      } else {
          return "Asociación fuerte";
      }
  }

  // LÓGICA PARA iat1 (Personas obesas/Personas delgadas)
  function getAssociationiat1(lower, upper) {
      if (lower >= -0.15 && upper <= 0.15) {
          return "Neutral";
      } else if (upper <= -0.15) {
          var c1 = getClassification(lower);
          var c2 = getClassification(upper);
          var classes = [];
          if (c1 !== "Neutral") classes.push(c1);
          if (c2 !== c1 && c2 !== "Neutral") classes.push(c2);
          return classes
            .map(function(cl){ return cl + " a Personas delgadas+bueno, Personas obesas+malo"; })
            .join(" y ");
      } else if (lower >= 0.15) {
          var c1 = getClassification(lower);
          var c2 = getClassification(upper);
          var classes = [];
          if (c1 !== "Neutral") classes.push(c1);
          if (c2 !== c1 && c2 !== "Neutral") classes.push(c2);
          return classes
            .map(function(cl){ return cl + " a Personas obesas+bueno, Personas delgadas+malo"; })
            .join(" y ");
      } else {
          var parts = [];
          if (lower < -0.15) {
              var cn = getClassification(lower);
              if (cn !== "Neutral") parts.push(cn + " a Personas delgadas+bueno, Personas obesas+malo");
          }
          if (lower <  0.15 && upper > -0.15) {
              parts.push("Neutral");
          }
          if (upper > 0.15) {
              var cp = getClassification(upper);
              if (cp !== "Neutral") parts.push(cp + " a Personas obesas+bueno, Personas delgadas+malo");
          }
          return parts.join(" y ");
      }
  }

  // LÓGICA PARA iat2 (Personas homosexuales/Personas heterosexuales)
  function getAssociationiat2(lower, upper) {
      if (lower >= -0.15 && upper <= 0.15) {
          return "Neutral";
      } else if (upper <= -0.15) {
          var c1 = getClassification(lower);
          var c2 = getClassification(upper);
          var classes = [];
          if (c1 !== "Neutral") classes.push(c1);
          if (c2 !== c1 && c2 !== "Neutral") classes.push(c2);
          return classes
            .map(function(cl){ return cl + " a Personas heterosexuales+bueno, Personas homosexuales+malo"; })
            .join(" y ");
      } else if (lower >= 0.15) {
          var c1 = getClassification(lower);
          var c2 = getClassification(upper);
          var classes = [];
          if (c1 !== "Neutral") classes.push(c1);
          if (c2 !== c1 && c2 !== "Neutral") classes.push(c2);
          return classes
            .map(function(cl){ return cl + " a Personas homosexuales+bueno, Personas heterosexuales+malo"; })
            .join(" y ");
      } else {
          var parts = [];
          if (lower < -0.15) {
              var cn = getClassification(lower);
              if (cn !== "Neutral") parts.push(cn + " a Personas heterosexuales+bueno, Personas homosexuales+malo");
          }
          if (lower <  0.15 && upper > -0.15) {
              parts.push("Neutral");
          }
          if (upper > 0.15) {
              var cp = getClassification(upper);
              if (cp !== "Neutral") parts.push(cp + " a Personas homosexuales+bueno, Personas heterosexuales+malo");
          }
          return parts.join(" y ");
      }
  }


  // iat1: slider de doble handle
  var slideriat1 = document.getElementById('slider_iat1');
  noUiSlider.create(slideriat1, {
      start: [-0.05, 0.05],
      connect: true,
      range: { 'min': -2, 'max': 2 },
      step: 0.01
  });
  var iat1Lower   = document.getElementById('iat1_lower_limit');
  var iat1Upper   = document.getElementById('iat1_upper_limit');
  var displayiat1 = document.getElementById('display_iat1_range');
  var associat1   = document.getElementById('assoc_iat1');

  slideriat1.noUiSlider.on('update', function (values) {
      var lowerVal = parseFloat(values[0]);
      var upperVal = parseFloat(values[1]);
      iat1Lower.value = lowerVal;
      iat1Upper.value = upperVal;
      displayiat1.textContent = '[' + lowerVal.toFixed(2) + ', ' + upperVal.toFixed(2) + ']';
  });

  // iat2: slider de doble handle
  var slideriat2 = document.getElementById('slider_iat2');
  noUiSlider.create(slideriat2, {
      start: [-0.05, 0.05],
      connect: true,
      range: { 'min': -2, 'max': 2 },
      step: 0.01
  });
  var iat2Lower   = document.getElementById('iat2_lower_limit');
  var iat2Upper   = document.getElementById('iat2_upper_limit');
  var displayiat2 = document.getElementById('display_iat2_range');
  var associat2   = document.getElementById('assoc_iat2');

  slideriat2.noUiSlider.on('update', function (values) {
      var lowerVal = parseFloat(values[0]);
      var upperVal = parseFloat(values[1]);
      iat2Lower.value = lowerVal;
      iat2Upper.value = upperVal;
      displayiat2.textContent = '[' + lowerVal.toFixed(2) + ', ' + upperVal.toFixed(2) + ']';});
</script>

{% endblock %}
