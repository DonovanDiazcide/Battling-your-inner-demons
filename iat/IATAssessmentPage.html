{% block title %}
    IAT assessment
{% endblock %}

{% block styles  %}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.css" rel="stylesheet"/>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }
        form {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        h2, h3 {
            color: #333;
            text-align: center;
            margin-bottom: 15px;
        }
        p, ul {
            text-align: center;
            line-height: 1.5;
            color: #444;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        ul li {
            margin: 4px 0;
        }
        /* Estilo “pizarra” para 7 columnas con botones atractivos */
        .iat-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background-color: #333;
            border: 2px solid #fff;
            margin: 20px auto;
            border-radius: 4px;
            overflow: hidden;
        }
        .iat-container label {
            margin: 0;
        }
        .iat-column {
            position: relative;
            border-right: 2px solid #fff;
            cursor: pointer;
            text-align: center;
            color: #fff;
            padding: 20px 5px;
            user-select: none;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .iat-column:last-child {
            border-right: none;
        }
        .iat-column input[type="radio"] {
            display: none;
        }
        .iat-column .text {
            font-size: 0.85rem;
            line-height: 1.3;
        }
        .iat-column:hover {
            background-color: #444;
            transform: translateY(-2px);
        }
        .iat-column input[type="radio"]:checked + .text {
            background-color: #666;
            border-radius: 4px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        /* Slider Section */
        .slider-section {
            margin: 25px 0;
        }
        .slider-section label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
            text-align: center;
        }
        .range-display {
            margin-top: 8px;
            color: #555;
            font-style: italic;
            text-align: center;
        }
        /* NoUiSlider container */
        .slider {
            margin: 0 auto 10px auto;
            width: 90%;
        }
        /* Asociación dinámica */
        .assoc-display {
            text-align: center;
            font-size: 1.1rem;
            color: #007bff;
            margin-bottom: 15px;
        }
        /* Botón */
        button {
            display: block;
            width: 100%;
            padding: 14px;
            margin-top: 30px;
            background-color: #007bff;
            color: #fff;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        /* Errores */
        .otree-form-errors {
            color: red;
            margin-top: 5px;
            font-size: 0.9rem;
            text-align: center;
        }
    </style>
{% endblock %}

{% block content %}

<h2>Clasificaciones posibles</h2>
<p>Tu resultado puede estar entre <strong>-2</strong> y <strong>2</strong>:</p>
<ul>
    <li><strong>Entre 0 y ±0.15:</strong> Neutral</li>
    <li><strong>De ±0.15 a ±0.35:</strong> Asociación leve</li>
    <li><strong>De ±0.35 a ±0.65:</strong> Asociación moderada</li>
    <li><strong>Mayor que ±0.65:</strong> Asociación fuerte</li>
</ul>
<p>¡Recuerda! Te incentivaremos si aciertas en tu respuesta. ¡Buena suerte!</p>

<!-- Mensaje introductorio para la selección -->
<p style="text-align: center; font-weight: bold; margin-bottom: 20px;">¿Cuál crees que es el resultado de tu IAT?</p>

<form method="post">

    <!-- ====================== IAT1: Gato/Perro ====================== -->
    <h3>IAT de gato y perro</h3>

    <!-- Radio Buttons (7 columnas) con Neutral en el centro (opción 4) -->
    <div class="iat-container">
      <!-- Opción 1: Asociación fuerte a gato+triste, perro+feliz -->
      <label class="iat-column">
        <input type="radio" name="iat1_self_assessment" value="Asociación fuerte a gato+triste, perro+feliz" />
        <div class="text"><strong>Fuerte</strong><br>gato+triste,<br>perro+feliz</div>
      </label>
      <!-- Opción 2: Asociación moderada a gato+triste, perro+feliz -->
      <label class="iat-column">
        <input type="radio" name="iat1_self_assessment" value="Asociación moderada a gato+triste, perro+feliz" />
        <div class="text"><strong>Moderada</strong><br>gato+triste,<br>perro+feliz</div>
      </label>
      <!-- Opción 3: Asociación leve a gato+triste, perro+feliz -->
      <label class="iat-column">
        <input type="radio" name="iat1_self_assessment" value="Asociación leve a gato+triste, perro+feliz" />
        <div class="text"><strong>Leve</strong><br>gato+triste,<br>perro+feliz</div>
      </label>
      <!-- Opción 4: Neutral (centrado) -->
      <label class="iat-column">
        <input type="radio" name="iat1_self_assessment" value="Neutral" />
        <div class="text"><strong>Neutral</strong></div>
      </label>
      <!-- Opción 5: Asociación leve a gato+feliz, perro+triste -->
      <label class="iat-column">
        <input type="radio" name="iat1_self_assessment" value="Asociación leve a gato+feliz, perro+triste" />
        <div class="text"><strong>Leve</strong><br>gato+feliz,<br>perro+triste</div>
      </label>
      <!-- Opción 6: Asociación moderada a gato+feliz, perro+triste -->
      <label class="iat-column">
        <input type="radio" name="iat1_self_assessment" value="Asociación moderada a gato+feliz, perro+triste" />
        <div class="text"><strong>Moderada</strong><br>gato+feliz,<br>perro+triste</div>
      </label>
      <!-- Opción 7: Asociación fuerte a gato+feliz, perro+triste -->
      <label class="iat-column">
        <input type="radio" name="iat1_self_assessment" value="Asociación fuerte a gato+feliz, perro+triste" />
        <div class="text"><strong>Fuerte</strong><br>gato+feliz,<br>perro+triste</div>
      </label>
    </div>
    {{ formfield_errors 'iat1_self_assessment' }}

    <!-- Range Slider (Double-handle) para iat1_lower_limit e iat1_upper_limit -->
    <div class="slider-section">
      <label>
        ¿Cuál sería para ti un rango moralmente aceptable para el IAT gato/perro? Actualmente estás seleccionando:
        <span class="range-display" id="display_iat1_range"></span>
      </label>
      <div id="slider_iat1" class="slider"></div>
      <div class="assoc-display" id="assoc_iat1"></div>
      <!-- Inputs ocultos -->
      <input type="hidden" name="iat1_lower_limit" id="iat1_lower_limit"/>
      <input type="hidden" name="iat1_upper_limit" id="iat1_upper_limit"/>
      {{ formfield_errors 'iat1_lower_limit' }}
      {{ formfield_errors 'iat1_upper_limit' }}
    </div>

    <hr>

    <!-- ====================== IAT2: Blanco/Negro ====================== -->
    <h3>IAT de blanco y negro</h3>

    <!-- Radio Buttons (7 columnas) con Neutral centrado -->
    <div class="iat-container">
      <!-- Opción 1: Asociación fuerte a blanco+triste, negro+feliz -->
      <label class="iat-column">
        <input type="radio" name="iat2_self_assessment" value="Asociación fuerte a blanco+triste, negro+feliz" />
        <div class="text"><strong>Fuerte</strong><br>blanco+triste,<br>negro+feliz</div>
      </label>
      <!-- Opción 2: Asociación moderada a blanco+triste, negro+feliz -->
      <label class="iat-column">
        <input type="radio" name="iat2_self_assessment" value="Asociación moderada a blanco+triste, negro+feliz" />
        <div class="text"><strong>Moderada</strong><br>blanco+triste,<br>negro+feliz</div>
      </label>
      <!-- Opción 3: Asociación leve a blanco+triste, negro+feliz -->
      <label class="iat-column">
        <input type="radio" name="iat2_self_assessment" value="Asociación leve a blanco+triste, negro+feliz" />
        <div class="text"><strong>Leve</strong><br>blanco+triste,<br>negro+feliz</div>
      </label>
      <!-- Opción 4: Neutral (centrado) -->
      <label class="iat-column">
        <input type="radio" name="iat2_self_assessment" value="Neutral" />
        <div class="text"><strong>Neutral</strong></div>
      </label>
      <!-- Opción 5: Asociación leve a blanco+feliz, negro+triste -->
      <label class="iat-column">
        <input type="radio" name="iat2_self_assessment" value="Asociación leve a blanco+feliz, negro+triste" />
        <div class="text"><strong>Leve</strong><br>blanco+feliz,<br>negro+triste</div>
      </label>
      <!-- Opción 6: Asociación moderada a blanco+feliz, negro+triste -->
      <label class="iat-column">
        <input type="radio" name="iat2_self_assessment" value="Asociación moderada a blanco+feliz, negro+triste" />
        <div class="text"><strong>Moderada</strong><br>blanco+feliz,<br>negro+triste</div>
      </label>
      <!-- Opción 7: Asociación fuerte a blanco+feliz, negro+triste -->
      <label class="iat-column">
        <input type="radio" name="iat2_self_assessment" value="Asociación fuerte a blanco+feliz, negro+triste" />
        <div class="text"><strong>Fuerte</strong><br>blanco+feliz,<br>negro+triste</div>
      </label>
    </div>
    {{ formfield_errors 'iat2_self_assessment' }}

    <!-- Range Slider (Double-handle) para iat2_lower_limit e iat2_upper_limit -->
    <div class="slider-section">
      <label>
        Rango moralmente aceptable (blanco/negro):
        <span class="range-display" id="display_iat2_range"></span>
      </label>
      <div id="slider_iat2" class="slider"></div>
      <div class="assoc-display" id="assoc_iat2"></div>
      <input type="hidden" name="iat2_lower_limit" id="iat2_lower_limit"/>
      <input type="hidden" name="iat2_upper_limit" id="iat2_upper_limit"/>
      {{ formfield_errors 'iat2_lower_limit' }}
      {{ formfield_errors 'iat2_upper_limit' }}
    </div>

    <button type="submit">Continuar</button>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.js"></script>
<script>
  // Función para determinar la clasificación en función del valor
  function getClassification(value) {
      var absVal = Math.abs(value);
      if (absVal < 0.15) {
          return "Neutral";
      } else if (absVal < 0.35) {
          return "Asociación leve";
      } else if (absVal < 0.65) {
          return "Asociación moderada";
      } else {
          return "Asociación fuerte";
      }
  }
  // Para IAT1:
  function getAssociationIAT1(lower, upper) {
      var negClass = getClassification(lower);
      var posClass = getClassification(upper);
      var negAssoc = (negClass === "Neutral") ? "Neutral" : negClass + " a gato+triste, perro+feliz";
      var posAssoc = (posClass === "Neutral") ? "Neutral" : posClass + " a gato+feliz, perro+triste";
      if (negAssoc === posAssoc) {
          return negAssoc;
      } else {
          return negAssoc + " y " + posAssoc;
      }
  }
  // Para IAT2:
  function getAssociationIAT2(lower, upper) {
      var negClass = getClassification(lower);
      var posClass = getClassification(upper);
      var negAssoc = (negClass === "Neutral") ? "Neutral" : negClass + " a blanco+triste, negro+feliz";
      var posAssoc = (posClass === "Neutral") ? "Neutral" : posClass + " a blanco+feliz, negro+triste";
      if (negAssoc === posAssoc) {
          return negAssoc;
      } else {
          return negAssoc + " y " + posAssoc;
      }
  }

  // IAT1: Crear slider de doble handle
  var sliderIAT1 = document.getElementById('slider_iat1');
  noUiSlider.create(sliderIAT1, {
      start: [-1, 1],
      connect: true,
      range: { 'min': -2, 'max': 2 },
      step: 0.01
  });
  var iat1Lower = document.getElementById('iat1_lower_limit');
  var iat1Upper = document.getElementById('iat1_upper_limit');
  var displayIAT1 = document.getElementById('display_iat1_range');
  var assocIAT1 = document.getElementById('assoc_iat1');

  sliderIAT1.noUiSlider.on('update', function (values, handle) {
      var lowerVal = parseFloat(values[0]);
      var upperVal = parseFloat(values[1]);
      iat1Lower.value = lowerVal;
      iat1Upper.value = upperVal;
      displayIAT1.textContent = '[' + lowerVal.toFixed(2) + ', ' + upperVal.toFixed(2) + ']';
      assocIAT1.textContent = "Actualmente, tu rango moral se clasifica como: " + getAssociationIAT1(lowerVal, upperVal);
  });

  // IAT2: Crear slider de doble handle
  var sliderIAT2 = document.getElementById('slider_iat2');
  noUiSlider.create(sliderIAT2, {
      start: [-1, 1],
      connect: true,
      range: { 'min': -2, 'max': 2 },
      step: 0.01
  });
  var iat2Lower = document.getElementById('iat2_lower_limit');
  var iat2Upper = document.getElementById('iat2_upper_limit');
  var displayIAT2 = document.getElementById('display_iat2_range');
  var assocIAT2 = document.getElementById('assoc_iat2');

  sliderIAT2.noUiSlider.on('update', function (values, handle) {
      var lowerVal = parseFloat(values[0]);
      var upperVal = parseFloat(values[1]);
      iat2Lower.value = lowerVal;
      iat2Upper.value = upperVal;
      displayIAT2.textContent = '[' + lowerVal.toFixed(2) + ', ' + upperVal.toFixed(2) + ']';
      assocIAT2.textContent = "Actualmente, tu rango moral se clasifica como: " + getAssociationIAT2(lowerVal, upperVal);
  });
</script>

{% endblock %}
