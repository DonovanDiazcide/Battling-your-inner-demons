{# templates/iat/ComprehensionFeedback.html #}
{% extends "global/Page.html" %}
{% load otree %}

{% block title %}Resultados del cuestionario{% endblock %}

{% block content %}
<p>Acertaste {{ score }} de {{ total }} preguntas.</p>

{% for fname, info in results.items %}
  <hr>
  <p>{{ info.text|safe }}</p>

<p>
  Respondiste
  <strong>{{ info.given_label|safe }}</strong>,
  lo cual es
  {% if info.ok %}
    <span class="text-success fw-bold">CORRECTO</span>.
  {% else %}
    <span class="text-danger fw-bold">INCORRECTO</span>.
  {% endif %}
</p>


  {% if fname == 'stage_order' %}
    {# ——— Feedback especial para la pregunta de orden —— #}
    <p><strong>Tu orden elegido:</strong></p>
    <ol>
      {% for etapa in info.given.splitlines %}
        <li>{{ etapa }}</li>
      {% endfor %}
    </ol>

    {% if not info.ok %}
      <p class="text-primary"><strong>Orden correcto:</strong></p>
      <ol>
        {% for etapa in info.correct.splitlines %}
          <li>{{ etapa }}</li>
        {% endfor %}
      </ol>
    {% endif %}
  {% else %}
    {# ——— Lista de opciones habituales —— #}
    {% if info.options %}
      <ul class="mb-2">
        {% for val,label in info.options %}
          <li class="
              {% if val == info.correct %}fw-bold text-primary{% endif %}
              {% if val == info.given and not info.ok %} text-danger{% endif %}
          ">
            {{ label|safe }}
            {% if val == info.correct %}
              <span class="badge bg-success ms-1">Correcta</span>
            {% endif %}
            {% if val == info.given and not info.ok %}
              <span class="badge bg-danger ms-1">Tu elección</span>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endif %}

  <p><em>Explicación:</em> {{ info.explanation|safe }}</p>
{% endfor %}

{{ next_button }}
{% endblock %}
