{% extends "global/Page.html" %}
{% load static %}

{% block styles %}
  <link href="{% static 'iat.css' %}" rel="stylesheet"/>
  <style>
    /* Tarjetas de pregunta */
    .question-card {
      border: 1px solid #dee2e6;
      border-radius: .375rem;
      box-shadow: 0 2px 4px rgba(0,0,0,.05);
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: #fff;
    }
    .question-card strong {
      color: #333;
      font-size: 1.05rem;
    }
    /* Lista sortable */
    #sortable li {
      cursor: grab;
      background: #f8f9fa;
      margin-bottom: .5rem;
      padding: .75rem 1rem;
      border-radius: .25rem;
      user-select: none;
    }
    #sortable li.dragging {
      opacity: .6;
    }
    #sortable li.over {
      border: 2px dashed #0d6efd;
    }
  </style>
{% endblock %}

{% block content %}
  <h3 class="mb-4">Cuestionario de comprensi√≥n</h3>

  <form method="post" novalidate>

    <!-- Pregunta 1 -->
    <div class="question-card">
      <strong>{{ form.compr1_q1.label }}</strong>
      <div class="mt-2">{{ form.compr1_q1 }}</div>
    </div>

    <!-- Pregunta 2 -->
    <div class="question-card">
      <strong>{{ form.compr1_q2.label }}</strong>
      <div class="mt-2">{{ form.compr1_q2 }}</div>
    </div>

    <!-- Pregunta 3: ordenar etapas -->
    <div class="question-card">
      <strong>{{ form.compr1_order.label }}</strong>
      <input type="hidden" name="compr1_order" id="compr1_order">
      <ul id="sortable" class="list-group mt-2 mb-0">
        {% for etapa in stages %}
          <li class="list-group-item" draggable="true">{{ etapa }}</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Pregunta 4 -->
    <div class="question-card">
      <strong>{{ form.compr1_q4.label }}</strong>
      <div class="mt-2">{{ form.compr1_q4 }}</div>
    </div>

    <!-- Pregunta 5 -->
    <div class="question-card">
      <strong>{{ form.compr1_q5.label }}</strong>
      <div class="mt-2">{{ form.compr1_q5 }}</div>
    </div>

    <!-- Pregunta 6 -->
    <div class="question-card">
      <strong>{{ form.compr1_q6.label }}</strong>
      <div class="mt-2">{{ form.compr1_q6 }}</div>
    </div>

    <button type="submit" class="btn btn-primary btn-lg w-100">Siguiente</button>
  </form>
{% endblock %}

{% block scripts %}
<script>
  let dragSrc = null;
  function start(e) {
    dragSrc = this;
    e.dataTransfer.effectAllowed = 'move';
    this.classList.add('dragging');
  }
  function over(e) {
    e.preventDefault();
    this.classList.add('over');
    return false;
  }
  function leave() {
    this.classList.remove('over');
  }
  function drop(e) {
    e.stopPropagation();
    if (dragSrc !== this) {
      [this.innerText, dragSrc.innerText] = [dragSrc.innerText, this.innerText];
    }
    return false;
  }
  function end() {
    this.classList.remove('dragging');
    document.querySelectorAll('#sortable li').forEach(li => li.classList.remove('over'));
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    document.querySelectorAll('#sortable li').forEach(li => {
      li.addEventListener('dragstart', start);
      li.addEventListener('dragover', over);
      li.addEventListener('dragleave', leave);
      li.addEventListener('drop', drop);
      li.addEventListener('dragend', end);
    });
    document.querySelector('form').onsubmit = ()=>{
      const orden = Array.from(document.querySelectorAll('#sortable li'))
        .map(li => li.innerText)
        .join(', ');
      document.getElementById('compr1_order').value = orden;
    };
  });
</script>
{% endblock %}
